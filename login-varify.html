<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="website" property="og:type">
  <meta property="og:title" content="Login | 365Connect Community">
  <meta property="og:description"
    content="365Connect is a community dedicated to promoting and advancing the adoption of Microsoft D365 and Power Platform technologies. Our primary goal is to foster a supportive environment where individuals can learn, teach, and collaborate on all things related to these powerful tools. Whether you're an experienced user or just starting out, we welcome members from any part of the globe to join us in our mission to promote and develop this community.">
  <meta property="og:image" content="https://365connectcommunity.github.io/preview.png">
  <meta property="og:url" content="https://365connectcommunity.github.io/login">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description"
    content="365Connect is a community dedicated to promoting and advancing the adoption of Microsoft D365 and Power Platform technologies. Our primary goal is to foster a supportive environment where individuals can learn, teach, and collaborate on all things related to these powerful tools. Whether you're an experienced user or just starting out, we welcome members from any part of the globe to join us in our mission to promote and develop this community.">
  
  <!---->
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900"
        rel="stylesheet">


    <!-- Bootstrap core CSS -->

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-grad-school.css">
    <link rel="stylesheet" href="assets/css/owl.css">
    <link rel="stylesheet" href="assets/css/lightbox.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign-In | 365Connect Community</title>
    <link rel="stylesheet" href="styles.css">

    <script src="vendor/jquery/jquery.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/jquery-3.3.1.slim.min.js">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: url(./assets/images/contact-bg.jpg);
            margin: 0;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            height: 100vh;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .login-container {
            background-color: rgba(256, 256, 256, .1);
            backdrop-filter: blur(16px);
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
            width: 300px;
            margin-top: 80px;
            padding: 20px;
            text-align: center;
        }

        .login-container h2 {
            margin-bottom: 20px;
            color: white;
        }

        .login-container input[type="text"],
        .login-container input[type="password"] {
            width: 100%;
            padding: 10px;
            margin: 10px -15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            color: white;
            background-color: #152137;
        }

        .login-container button {
            background-color: orange;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
        }

        .login-container button:hover {
            background-color: #0056b3;
        }

        .login-container p {
            margin-top: 10px;
            color: #888;
        }

        .in-put {
            height: 30px;
        }

        .bntn {
            height: 40px;
            width: 100px;
        }

        .alert {
            background-color: coral;
            width: 100%;
            padding: 10px;
            margin-left: -10px;
            margin-top: 10px;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <header class="main-header clearfix" role="header">
        <div class="logo">
            <img id="header-logo" style="height: 50px; margin-right: 20px;" src="./favicon.ico">
            <a href="./" style="text-decoration: none; font-size: 29px !important;"><em></em><span
                    style="color: #feb70c;">3</span><span style="color: #5ea904;">6</span><span
                    style="color: #04a0ed;">5</span><span style="color: white;">C</span><span
                    style="text-transform: lowercase;">onnect</span></a><!--#ce392c;-->
        </div>
        <a href="#menu" class="menu-link"><i class="fa fa-bars"></i></a>
        <nav id="menu" class="main-nav" role="navigation">
            <ul class="main-menu">
                <li><a href="./">Home</a></li>
                <li class="has-submenu"><a href="#">Our Family</a>
                    <ul class="sub-menu">
                        <li><a href="./team-members" class="external">Contributors</a></li>
                        <li><a href="./community-members" class="external">Members</a></li>
                        <li><a href="./become-contributor" class="external">Become Contributor</a></li>
                        <li><a href="./signup" class="external">Become Member</a></li>
                    </ul>
                </li>
                <li class="has-submenu"><a href="#">Resources</a>
                    <ul class="sub-menu">
                        <li><a href="./events" class="external">Events</a></li>
                        <li><a href="./blog" class="external">Blogs</a></li>
                        <li><a href="./courses" class="external">Courses</a></li>
                        <li><a href="./sample-solutions" class="external">Sample Solutions</a></li>
                    </ul>
                </li>
                <li class="has-submenu"><a href="#">Contact Us</a>
                    <ul class="sub-menu">
                        <li><a href="./support" class="external">Get Support</a></li>
                        <li><a href="./" class="external">Seek Guidance</a></li>
                        <li><a href="./our-socials" class="external">Our Socials</a></li>
                    </ul>
                </li>
                <!-- <li><a href="https://365connectcommunity.azurewebsites.net/" class="external" id="cartimg"></a></li> -->
            </ul>
        </nav>
    </header>
    <div class="loading" id="loading">Loading&#8230;</div>
    <div class="login-container">
        <a href="" target="_b" class="author1" style="box-shadow:  rgba(0, 0, 0, 0.35) 0px 5px 15px !important;"></a>
        <div id="login-container"></div>

        <input class="in-put" type="password" placeholder="Varification Code" id="code">
        <p id="resendtext">Didn't revieve an email? Check spam or <a id="resend">Resend</a> </p>
        <button class="bntn" onclick="submit()">Continue</button>
        <div class="message" id="message">
        </div>
    </div>

</body>
<script>
    if (localStorage.getItem("name") == null || localStorage.getItem("email") == null || localStorage.getItem("email") == 'null' || localStorage.getItem("name") == 'null' || localStorage.getItem("email") == '' || localStorage.getItem("name") == '') {
        console.log("not signed in")
        if (localStorage.getItem("email1") == null || localStorage.getItem("email1") == 'null' || localStorage.getItem("email1") == 'undefined' || localStorage.getItem("email1") == undefined) {
            let url = "./login";
            window.location.href = url;
        }
    }
    else {
        let url = "./my-profile";
        window.location.href = url;
    }
    const authorElement = document.querySelector('.author1');
    console.log(localStorage.getItem("image1"))
    if (localStorage.getItem("image1") == '' || localStorage.getItem("image1") == null || localStorage.getItem("image1") == 'null' || localStorage.getItem("image1") == 'undefined') {
        authorElement.style.background = 'url(https://static.vecteezy.com/system/resources/thumbnails/005/545/335/small/user-sign-icon-person-symbol-human-avatar-isolated-on-white-backogrund-vector.jpg) center no-repeat';
    }
    else {
        authorElement.style.background = `url(data:image/png;base64,${localStorage.getItem("image1")}) center no-repeat`;
    }
    var signedIn = localStorage.getItem("name") == null || localStorage.getItem("email") == null || localStorage.getItem("email") == 'null' || localStorage.getItem("name") == 'null' || localStorage.getItem("email") == '' || localStorage.getItem("name") == '' || localStorage.getItem("email") == undefined || localStorage.getItem("name") == undefined;
    function generateProfileSubMenu() {
        if (signedIn) {
            return `
    <li class="has-submenu active">
      <img id= "myprofilepic" src="./assets/images/icons8-account-64.png" style="width:45px;height:45px;border-radius:200px;border:0px solid orange;">
      <ul class="sub-menu">
        <li><a href="./login" class="external">Sign In</a></li>
        <li><a href="./signup" class="external">Sign Up</a></li>
      </ul>
    </li>
  `;
        }
        else {
            return `
    <li class="has-submenu active">
      <img id= "myprofilepic" src="data:image/png;base64,${localStorage.getItem("image")}" style="width:45px;height:45px;border-radius:200px;border:2px solid orange;">
      <ul class="sub-menu">
        <li><a href="./login" class="external">${localStorage.firstname}</a></li>
        <li><a href="./login" class="external">My Registrations</a></li>
        <li><a href="./my-certificates" class="external">My Certificates</a></li>
        <li><a href="./" class="external" id="logout">Sign Out</a></li>
      </ul>
    </li>
  `;
        }
    }


    // Add a click event listener


    // Find the parent ul element with the class "main-menu"
    const mainMenu = document.querySelector('.main-menu');

    // Append the "Profile" submenu HTML to the mainMenu
    mainMenu.insertAdjacentHTML('beforeend', generateProfileSubMenu());
    const myLink = document.getElementById('logout');
    if (document.getElementById('logout'))
        myLink.addEventListener('click', function (event) {
            // Prevent the default behavior (e.g., navigating to the href URL)
            event.preventDefault();

            // You can also perform other actions here
            localStorage.setItem("name", null);
            localStorage.setItem("email", null);
            localStorage.setItem("image", null);
            window.location.href = './';

        });
    const url_string = window.location.href;
    const url = new URL(url_string);
    //const email = url.searchParams.get("email");
    //const fullname = url.searchParams.get("name");
    const email = localStorage.getItem("email1");
    const fullname = localStorage.getItem("name1");
    const heading = document.getElementById("login-container");
    const text = document.createElement("input");
    text.id = "email"
    const hr = document.createElement("hr");
    const text2 = document.createElement("h2");
    const text3 = document.createElement("p");
    text3.innerText = "Verification code has been sent to your email. Code will expire after 5 minutes."
    text.classList.add("in-put");
    text.placeholder = "Email";
    text.type = "text";
    text.value = email;
    text.disabled = true;
    text2.textContent = "Welcome, " + fullname.split(' ')[0];
    heading.appendChild(text2);
    heading.appendChild(hr);
    heading.appendChild(text3)
    heading.appendChild(text);
    document.getElementById("loading").style.display = "none";
    function submit() {
        var myDiv = document.getElementById("message");
        var headingToDelete = document.querySelector(".alert");
        if (headingToDelete) {
            myDiv.removeChild(headingToDelete);
        }
        var myDiv = document.getElementById("message");
        var headingToDelete = document.querySelector(".alert");
        if (headingToDelete) {
            myDiv.removeChild(headingToDelete);
        }
        if (document.getElementById("code").value == '')
            showError("Code is required")
        if (document.getElementById("code").value != '') {
            document.getElementById("loading").style.display = "block";
            var myHeaders = new Headers();
            myHeaders.append("email", document.getElementById("email").value);
            myHeaders.append("code", document.getElementById("code").value);

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                redirect: 'follow'
            };

            fetch("https://prod-127.westeurope.logic.azure.com:443/workflows/3fa135848c174b6ab5c96e435848c539/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=EiYXqTRJmErp41dJRg7PbOlf-UKGHe7n-PhmilTM6_w", requestOptions)
                .then(response => {
                    if (response.status === 200) {
                        // Construct the URL to navigate to
                        const url = "./my-profile";
                        localStorage.setItem("email", localStorage.email1);
                        localStorage.setItem("name", localStorage.name1);
                        localStorage.setItem("firstname", localStorage.firstname1);
                        localStorage.setItem("lastname", localStorage.lastname1);
                        localStorage.setItem("image", localStorage.image1);

                        localStorage.setItem("email1", null);
                        localStorage.setItem("name1", null);
                        localStorage.setItem("firstname1", null);
                        localStorage.setItem("lastname1", null);
                        localStorage.setItem("image1", null);

                        // Navigate to the desired URL
                        window.location.href = url;
                    } else {
                        // Handle other response statuses or errors here
                        showError("Code incorrect or expired. Try again");
                        document.getElementById("loading").style.display = "none";
                    }
                })
                .catch(error => {
                    // Handle other errors here
                    showError("Code incorrect or expired. Try again");
                    document.getElementById("loading").style.display = "none";
                });





        }
        //window.location.replace("./registrations?email="+document.getElementById("email").value)
    }
    function showError(alert, alertType) {
        var message = document.getElementById("message");
        var messagetext = document.createElement("div");
        messagetext.classList.add("alert")
        messagetext.classList.add("alert-" + alertType)
        messagetext.textContent = alert;
        message.appendChild(messagetext);
    }

    if (screen.height > screen.width) {
        document.getElementById("header-logo").hidden = true;
        document.querySelector(".menu-link").classList.remove("active");
        document.querySelector(".main-nav").classList.remove("active");
        document.querySelector(".main-nav").style.overflow = 'scroll';
        document.querySelector(".main-nav").style.height = 'inherit';
        document.querySelector(".main-nav").style.minHeight = '90vh';
        document.querySelector(".main-menu").hidden = true;
        document.querySelector(".fa").addEventListener("click", function () {
            if (document.querySelector(".menu-link").classList.value.includes("active")) {
                document.querySelector(".menu-link").classList.remove("active");
                document.querySelector(".main-nav").classList.remove("active");
                document.querySelector(".main-menu").hidden = false;
            }
            else {
                document.querySelector(".menu-link").classList.add("active");
                document.querySelector(".main-nav").classList.add("active");
                document.querySelector(".main-menu").hidden = true;
            }
        })
    }
    document.getElementById("resend").addEventListener("click",
        function (event) {

            event.preventDefault();
            document.getElementById("loading").style.display = "block";
            var myHeaders = new Headers();
            myHeaders.append("email", localStorage.email1);

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                redirect: 'follow'
            };

            fetch("https://prod-209.westeurope.logic.azure.com:443/workflows/c0bb2d10ed58415695b94bce060ac427/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=XfmNae_9UnsIvRwiXHv9vzk7h0L44wP1V3wa9gRcyPg", requestOptions)
                .then(response => {
                    if (response.status == 200) {
                        alert("Code Sent!")
                        document.getElementById("resendtext").innerText = "";
                        document.getElementById("loading").style.display = "none";
                    } else {
                        alert("Unable to send code. Try again later.")
                        document.getElementById("loading").style.display = "none";
                    }
                })
                .then(result => console.log(result))
                .catch(error => console.log('error', error));

        })
    if (screen.height > screen.width) {
        document.getElementById("header-logo").hidden = true;
        document.querySelector(".menu-link").classList.remove("active");
        document.querySelector(".main-nav").classList.remove("active");
        document.querySelector(".main-nav").style.overflow = 'scroll';
        document.querySelector(".main-nav").style.height = '60vh';
        document.querySelector(".main-nav").style.minHeight = '60vh';
        document.querySelector(".main-menu").hidden = true;
        // document.querySelector(".fa").addEventListener("click", function () {
        //     if(document.querySelector(".menu-link").classList.value.includes("active")){
        //         document.querySelector(".menu-link").classList.remove("active");
        //         document.querySelector(".main-nav").classList.remove("active");
        //         document.querySelector(".main-menu").hidden = false;
        //     }
        //     else{
        //     document.querySelector(".menu-link").classList.add("active");
        //     document.querySelector(".main-nav").classList.add("active");
        //     document.querySelector(".main-menu").hidden = true;
        //     }
        // })
    }
    if (screen.height > screen.width) {
        document.getElementById("myprofilepic").hidden = true;
    }
    if (localStorage.getItem("image") == '' || localStorage.getItem("image") == null || localStorage.getItem("image") == 'null' || localStorage.getItem("image") == 'undefined') {
      document.getElementById("myprofilepic").src = './assets/images/icons8-account-64.png';
    }
</script>

</html>