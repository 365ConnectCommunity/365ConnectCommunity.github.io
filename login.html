<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description"
        content="365Connect is a community dedicated to promoting and advancing the adoption of Microsoft D365 and Power Platform technologies. Our primary goal is to foster a supportive environment where individuals can learn, teach, and collaborate on all things related to these powerful tools. Whether you're an experienced user or just starting out, we welcome members from any part of the globe to join us in our mission to promote and develop this community.">
    <meta name="author" content="Shaheer Ahmad">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900"
        rel="stylesheet">


    <!-- Bootstrap core CSS -->

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-grad-school.css">
    <link rel="stylesheet" href="assets/css/owl.css">
    <link rel="stylesheet" href="assets/css/lightbox.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register | 365Connect Community</title>
    <link rel="stylesheet" href="styles.css">

    <script src="vendor/jquery/jquery.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/jquery-3.3.1.slim.min.js">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: #333; /* You can change the background color as needed */
        color: #fff; /* You can change the text color as needed */
        text-align: center;
        padding: 10px 0;
    }
        body {
            font-family: Arial, sans-serif;
            background: url(https://kpmglearningmalta.com/wp-content/uploads/2022/03/slide28.png);
            margin: 0;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;

            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .login-container {
            background-color: #152137;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
            width: 300px;
            padding: 20px;
            text-align: center;
        }

        .login-container h2 {
            margin-bottom: 20px;
            color: darkgrey;
        }

        .login-container input[type="text"],
        .login-container input[type="password"] {
            width: 100%;
            padding: 10px;
            margin: 10px -15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #152137;
            color: white;
        }

        .login-container button {
            background-color: orange;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
        }

        .login-container button:hover {
            background-color: #0056b3;
        }

        .login-container p {
            margin-top: 10px;
            color: #888;
        }

        .in-put {
            height: 30px;
        }

        .bntn {
            height: 40px;
            width: 100px;
        }

        .alert {
            background-color: coral;
            width: 100%;
            padding: 10px;
            margin-left: -10px;
            margin-top: 10px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <header class="main-header clearfix" role="header">
        <div class="logo">
            <img id="header-logo" style="height: 50px; margin-right: 20px;" src="./favicon.ico">
            <a href="./index.html" style="text-decoration: none; font-size: 29px !important;"><em></em><span
                    style="color: #feb70c;">3</span><span style="color: #5ea904;">6</span><span
                    style="color: #04a0ed;">5</span><span style="color: white;">C</span><span
                    style="text-transform: lowercase;">onnect</span></a><!--#ce392c;-->
        </div>
        <a href="#menu" class="menu-link"><i class="fa fa-bars"></i></a>
        <nav id="menu" class="main-nav" role="navigation">
            <ul class="main-menu">
                <li><a href="./index.html">Home</a></li>
                <li class="has-submenu"><a href="#">Our Family</a>
                    <ul class="sub-menu">
                        <li><a href="./team-members.html" class="external">Contributors</a></li>
                        <li><a href="./community-members.html" class="external">Members</a></li>
                    </ul>
                </li>
                <li class="has-submenu"><a href="#">Contributions</a>
                    <ul class="sub-menu">
                        <li><a href="./events.html" class="external">Events</a></li>
                        <li><a href="./blog.html" class="external">Blogs</a></li>
                        <li><a href="./become-contributor.html" class="external">Become Contributor</a></li>
                    </ul>
                </li>
                <li class="has-submenu"><a href="#">Contact Us</a>
                    <ul class="sub-menu">
                        <li><a href="./support.html" class="external">Get Support</a></li>
                        <li><a href="./index.html" class="external">Seek Guidance</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>
    <div class="loading" id="loading">Loading&#8230;</div>
    <div class="login-container">
        <h2>Continue with Email</h2>
        <hr><br>
        <input class="in-put" type="text" placeholder="Email" id="email"><br><br><br>
        <button class="bntn" onclick="submit()">Continue</button>
        <div class="message" id="message">
        </div>
    </div>
    
</body>
<script>
    const email = sessionStorage.getItem("email");
    const fullname = sessionStorage.getItem("name");
    if(sessionStorage.getItem("name") == null || sessionStorage.getItem("email") == null || sessionStorage.getItem("email") == 'null' || sessionStorage.getItem("name") == 'null'|| sessionStorage.getItem("email") == '' || sessionStorage.getItem("name") == ''){
        console.log("not signed in")
    }
    else{
        let url = "./my-profile.html";
        window.location.href = url;
    }
    var signedIn = sessionStorage.getItem("name") == null || sessionStorage.getItem("email") == null || sessionStorage.getItem("email") == 'null' || sessionStorage.getItem("name") == 'null' || sessionStorage.getItem("email") == '' || sessionStorage.getItem("name") == '' || sessionStorage.getItem("email") == undefined || sessionStorage.getItem("name") == undefined;
    function generateProfileSubMenu() {
      if (signedIn) {
        return `
    <li class="has-submenu active">
      <a href="#">Profile</a>
      <ul class="sub-menu">
        <li><a href="./login.html" class="external">Sign In</a></li>
      </ul>
    </li>
  `;
      }
      else {
        return `
    <li class="has-submenu active">
      <a href="#">Profile</a>
      <ul class="sub-menu">
        <li><a href="./login.html" class="external">${sessionStorage.firstname}</a></li>
        <li><a href="./login.html" class="external">My Registrations</a></li>
        <li><a href="./my-certificates.html" class="external">My Certificates</a></li>
        <li><a href="./index.html" class="external" id="logout">Sign Out</a></li>
      </ul>
    </li>
  `;
      }
    }
    

        // Add a click event listener
        

    // Find the parent ul element with the class "main-menu"
    const mainMenu = document.querySelector('.main-menu');

    // Append the "Profile" submenu HTML to the mainMenu
    mainMenu.insertAdjacentHTML('beforeend', generateProfileSubMenu());
    const myLink = document.getElementById('logout');
    if(document.getElementById('logout'))
    myLink.addEventListener('click', function (event) {
            // Prevent the default behavior (e.g., navigating to the href URL)
            event.preventDefault();

            // You can also perform other actions here
            sessionStorage.setItem("name", null);
      sessionStorage.setItem("email", null);
      sessionStorage.setItem("image", null);
      window.location.href = './index.html';
            
        });
    document.getElementById("loading").style.display = "none";
    function submit() {
        
        var myDiv = document.getElementById("message");
        var headingToDelete = document.querySelector(".alert");
        if (headingToDelete) {
            myDiv.removeChild(headingToDelete);
        }
        var myDiv = document.getElementById("message");
        var headingToDelete = document.querySelector(".alert");
        if (headingToDelete) {
            myDiv.removeChild(headingToDelete);
        }
        if (document.getElementById("email").value == '')
            showError("Email is required")
        if (document.getElementById("email").value != '') {
            document.getElementById("loading").style.display = "block";
            var myHeaders = new Headers();
            myHeaders.append("email", document.getElementById("email").value);

            var requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };

            fetch("https://prod-43.westeurope.logic.azure.com:443/workflows/6925f68ce8a842d8893aa7a606a6c8f4/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=-rUEpqm-E6NB2lrmxYrhX-CEj6IKu_-asLVQ_Qkcv4I", requestOptions)
                .then(response => {
                    if (response.status === 200) {
                        // Parse the response body as JSON
                        return response.json();
                    } else {
                        // Handle other response statuses or errors here
                        showError("Account not found");
                        document.getElementById("loading").style.display = "none";
                        return null;
                    }
                })
                .then(data => {
                    // Check if data is not null
                    if (data !== null) {
                        // Extract the necessary information from the data
                        const email = data.emailaddress1;
                        const name = data.fullname;
                        const firstname = data.firstname;
                        const lastname = data.lastname;
                        const image = data.entityimage;
                        console.log(image)

                        // Construct the URL with query parameters
                        const url = `./login-varify.html`;
                        sessionStorage.setItem("email1", email);
                        sessionStorage.setItem("name1",name);
                        sessionStorage.setItem("firstname1",firstname);
                        sessionStorage.setItem("lastname1",lastname);
                        sessionStorage.setItem("image1",image);
                        // Navigate to the desired URL
                        window.location.href = url;
                    }
                })
                .catch(error => {
                    showError("Account not found");
                    document.getElementById("loading").style.display = "none";
                });

            }
            //window.location.replace("./registrations.html?email="+document.getElementById("email").value)
        }
        function showError(alert, alertType) {
            var message = document.getElementById("message");
            var messagetext = document.createElement("div");
            messagetext.classList.add("alert")
            messagetext.classList.add("alert-" + alertType)
            messagetext.textContent = alert;
            message.appendChild(messagetext);
        }
        
        if (screen.height > screen.width){
            document.getElementById("header-logo").hidden = true;
        document.querySelector(".menu-link").classList.remove("active");
        document.querySelector(".main-nav").classList.remove("active");
        document.querySelector(".main-menu").hidden = true;
        document.querySelector(".fa").addEventListener("click", function () {
            if(document.querySelector(".menu-link").classList.value.includes("active")){
                document.querySelector(".menu-link").classList.remove("active");
                document.querySelector(".main-nav").classList.remove("active");
                document.querySelector(".main-menu").hidden = false;
            }
            else{
            document.querySelector(".menu-link").classList.add("active");
            document.querySelector(".main-nav").classList.add("active");
            document.querySelector(".main-menu").hidden = true;
            }
        })
    }
</script>

</html>